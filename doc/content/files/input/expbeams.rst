.. include:: /substitutions.rst

.. _expbeams:

EXPBEAMS
========

The EXPBEAMS file contains the experimental data (beam intensities vs.
energy, without normalization) to be compared against. The TensErLEED
Manager will look for an EXPBEAMS.csv file (with or without the .csv
extension) at initialization, but can also run without it up to the
search. Executing search or |R-factor| calculations is only possible
with an EXPBEAMS file as it requires experimental data to compare to.

Format
------

..  code-block:: none


   E, ( 1\| 0), ( 1\| 1), ( 1|-1)
   73.00, 5.40259E+02,         NaN,         NaN
   73.50, 4.91900E+02, 1.75857E+02,         NaN
   74.00, 4.43576E+02, 1.59667E+02,         NaN
   74.50, 3.98344E+02, 1.45197E+02,         NaN
   75.00, 3.59160E+02, 1.32677E+02,         NaN
   75.50, 3.28612E+02, 1.22006E+02,         NaN
    ...         ...          ...            ...

For backwards compatibility, old experimental beam files formatted as
:ref:`AUXEXPBEAMS<AUXEXPBEAMS>` can easily be transformed to the EXPBEAMS
file format with the :ref:`AUXEXPBEAMS_to_EXPBEAMS utility<aux_to_exp>`.

.. note::
    The EXPBEAMS.csv file generated by the ViPErLEED ImageJ
    plug-ins contains some extra information in the header line that is
    not used while comparing to calculated beams. The information is kept
    for the possible interest of users.
    For each beam, the EXPBEAMS.csv file generated by the ViPErLEED ImageJ
    plug-ins reports a (positive or negative) integer index between square
    brackets.
    This is a progressive index that identifies symmetry-equivalent beams,
    and comes straight from the Pattern File that can be exported from the
    Graphical User Interface.
    Beams with the same absolute value of 'group' are symmetry-equivalent,
    beams with negative 'group' are extinct.

    .. only:: html

        See |here| for an example (group indices are in the column ``group``).

    .. only:: not html

        See the in the online version of the documentation at
        `viperleed.org <viperleed.org>`__ for an example.

.. todo::
    For Michele: with ViPErLEED hardware paper, we should add entry for
    pattern file and link that instead.


.. warning::
    None of the EXPBEAMS.csv beams should have negative
    intensities.
    Negative intensities usually signal an inappropriate background
    subtraction. Beams with negative intensities will be offset to have
    minimum intensity equal to zero (issuing warnings of having done so).
    This behavior prevents errors while writing input files for the FORTRAN
    routines from TensErLEED. However, as this artificial offset affects
    the minima of the intensities, the |R factor| may be impacted
    significantly.
    We strongly advise that the problematic beams are fixed or discarded
    by removing them from :ref:`IVBEAMS<IVBEAMS>`.
    Consider improving background subtraction, or restricting the
    affected beams to the energy range where intensities are positive.


.. warning::
    Gaps in the experimental beam set (i.e. a beam reappearing at higher
    energies) are currently not supported â€“ neither supported in the spot
    tracker nor in |calc|.
    We recommend using only the longest continuous part of any beam.


.. |here| replace:: :download:`here</_static/pattern_file_example.pdf>`
